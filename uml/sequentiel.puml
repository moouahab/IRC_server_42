@startuml
skinparam monochrome false
skinparam sequence {
    ActorBorderColor DeepSkyBlue
    LifeLineBorderColor DeepSkyBlue
    LifeLineBackgroundColor LightSkyBlue
    ParticipantBackgroundColor AliceBlue
    ParticipantBorderColor DeepSkyBlue
    ArrowColor DeepSkyBlue
    ArrowThickness 2
}

actor Utilisateur as U
participant Client as C
participant Serveur as S
participant GestionnaireConnexions as GC
participant GestionnaireCanaux as GCan
participant Canal as CAN
participant CommandeReconstitution as CR
participant MessageTexteHandler as MTH
participant GestionnaireLogs as GL

== Connexion et Rejoindre un canal ==

U -> C : Demande à rejoindre un canal ("#general")
C -> S : Requête pour rejoindre le canal "#general"
S -> GC : Vérifier connexion du client
GC --> S : Connexion validée

S -> GCan : Rechercher ou créer canal "#general"
GCan -> CAN : Vérifier si le canal existe
alt Canal n'existe pas
    GCan -> CAN : Créer le canal "#general"
end
CAN -> GCan : Retourner le canal "#general"
GCan --> S : Canal trouvé ou créé

S -> CAN : Ajouter le client au canal "#general"
CAN --> S : Client ajouté avec succès

S --> C : Accès au canal accordé

note right of U : L'utilisateur a rejoint le canal avec succès.

== Envoi de message ==

U -> C : Envoyer message ("Bonjour à tous!")
C -> S : Transmettre message au serveur
S -> CR : Reconstituer commande à partir du message
CR --> S : Commande reconstituée

S -> MTH : Traiter le message
MTH -> CAN : Relayer message au canal "#general"
CAN -> GL : Archiver le message
GL --> CAN : Message archivé avec succès

CAN -> MTH : Confirmer traitement du message
MTH --> S : Message traité avec succès

S -> CAN : Diffuser message aux utilisateurs du canal
CAN -> C : Envoyer message aux autres utilisateurs

note right of C : Le message est envoyé à tous les utilisateurs du canal.
@enduml
